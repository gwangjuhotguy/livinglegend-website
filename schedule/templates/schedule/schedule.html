<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>2025년 5월 수거선 일정</title>
    <style>
        body { font-family: sans-serif; }
        .container { display: flex; justify-content: flex-start; margin-top: 20px; }
        .left-buttons { width: 15%; display: flex; flex-direction: column; align-items: flex-start; margin-left: 2%; }
        .left-buttons h3 { font-size: 20px; margin-bottom: 10px; margin-top: 20px; }
        .left-buttons a { padding: 6px 10px; margin-bottom: 6px; text-decoration: none; font-size: 16px; }
        .left-buttons a.blue { color: #007bff; }
        .left-buttons a.black { color: black; }
        .left-buttons a:hover { text-decoration: underline; }
        .calendar-container { width: 50%; margin-left: 2%; }
        h1 { text-align: center; font-size: 18px; margin-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; table-layout: fixed; font-size: 12px; }
        th, td { border: 1px solid #aaa; padding: 6px 4px; text-align: center; vertical-align: top; height: 60px; }
        th { background-color: #f0f0f0; }
        td span { font-size: 0.7em; display: block; margin-top: 3px; color: #333; }
        .right-panel { width: 30%; padding: 10px; margin-left: 2%; border: 1px solid #ccc; background-color: #f9f9f9; }
        .right-panel h3 { margin-bottom: 10px; }
        .report-card { border: 1px solid #ccc; background-color: #fff; padding: 10px; margin-bottom: 10px; font-size: 13px; }
        .report-card p { margin: 4px 0; }
        .assign-box { margin-top: 10px; padding: 10px; border: 1px solid #aaa; background: transparent; }
        .assign-box label, .assign-box select, .assign-box input { font-size: 14px; margin-top: 5px; width: 100%; padding: 4px; }
        .assign-box button {
            font-size: 16px;
            padding: 10px 20px;
            float: right;
            margin-top: 10px;
        }
        #assignmentResult {
            margin-top: 10px;
            color: green;
            clear: both;
        }
    </style>
</head>
<body>
    <h2>어구어구</h2>
    <div class="container">
        <div class="left-buttons">
            <h3>실시간 유실 어구</h3>
            <a href="{% url 'map_view' %}?view=assigned" class="blue">수거 완료 어구</a>

            <h3>어구 관리</h3>
            <a href="{% url 'gear_list' %}" class="blue">구매 정보 관리</a>
            <a href="{% url 'losting_gear' %}" class="blue">신고 정보 관리</a>

            <h3>수거선 관리</h3>
            <a href="{% url 'may-calendar' %}" class="blue">수거선 배정</a>

            <!-- 🔻 로그아웃 링크 -->
            <a href="/login/" class="blue" style="margin-top: 30px; font-weight: bold;">로그아웃</a>
        </div>

        <div class="calendar-container">
            <h1>2025년 5월</h1>
            <div>{{ calendar|safe }}</div>
        </div>

        <div class="right-panel">
            {% if unassigned_list %}
                <h3>수거 예정 어구</h3>
                {% for report in unassigned_list %}
                <div class="report-card">
                    <p><strong>신고 번호 :</strong> {{ report.report_id }}</p>
                    <p><strong>구매자 ID :</strong> {{ report.buyer_id }}</p>
                    <p><strong>신고 일자 :</strong> {{ report.report_time }}</p>
                    <p><strong>유실 위치(위도) :</strong> {{ report.latitude }}</p>
                    <p><strong>유실 위치(경도) :</strong> {{ report.longitude }}</p>
                </div>
                {% endfor %}

                <h3>수거선 배정</h3>
                <div class="assign-box">
                    <label for="reportSelect"><strong>신고 번호</strong></label>
                    <select id="reportSelect" name="report_id">
                        {% for report in unassigned_list %}
                        <option value="{{ report.report_id }}">{{ report.report_id }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="assign-box">
                    <label for="dateSelect"><strong>수거 예정 날짜</strong></label>
                    <select id="dateSelect" name="planned_date" onchange="fetchBoatsByDate()">
                        {% for date in may_dates %}
                        <option value="{{ date }}">{{ date }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="assign-box">
                    <label for="boatSelect"><strong>수거선</strong></label>
                    <select id="boatSelect" name="boat_id">
                        <option value="">날짜를 선택하세요</option>
                    </select>
                </div>

                <div class="assign-box">
                    <label for="manualLatitude"><strong>예상 위치(위도)</strong></label>
                    <input type="text" id="manualLatitude" name="manual_latitude" placeholder="예: 34.123456">
                </div>

                <div class="assign-box">
                    <label for="manualLongitude"><strong>예상 위치(경도)</strong></label>
                    <input type="text" id="manualLongitude" name="manual_longitude" placeholder="예: 127.654321">
                </div>

                <div class="assign-box" style="border: none; padding-top: 0;">
                    <button onclick="assignReport()">배정하기</button>
                    <p id="assignmentResult"></p>
                </div>
            {% else %}
                <p>모든 신고가 수거선에 할당되었습니다.</p>
            {% endif %}
        </div>
    </div>

    <script>
    function fetchBoatsByDate() {
        const selectedDate = document.getElementById("dateSelect").value;
        const boatSelect = document.getElementById("boatSelect");
        boatSelect.innerHTML = "<option>불러오는 중...</option>";

        fetch(`/schedule/available-boats/?date=${selectedDate}`)
            .then(response => response.text())
            .then(html => {
                if (html.trim() === "") {
                    boatSelect.innerHTML = '<option value="">해당 날짜에 수거선 없음</option>';
                } else {
                    boatSelect.innerHTML = html;
                }
            })
            .catch(error => {
                boatSelect.innerHTML = '<option value="">오류 발생</option>';
                console.error("Error fetching boats:", error);
            });
    }

    function assignReport() {
        const reportId = document.getElementById("reportSelect").value;
        const boatSelect = document.getElementById("boatSelect");
        const boatId = boatSelect.value;
        const boatCompany = boatSelect.options[boatSelect.selectedIndex]?.text;
        const resultBox = document.getElementById("assignmentResult");

        if (!reportId || !boatId) {
            resultBox.style.color = 'red';
            resultBox.textContent = "신고 번호와 수거선을 모두 선택하세요.";
            return;
        }

        resultBox.style.color = 'green';
        resultBox.textContent = `${reportId}번 신고가 "${boatCompany}"에 배정되었습니다.`;
    }
    </script>
</body>
</html>









